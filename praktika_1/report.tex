\input{../template.tex}

% Dokumentinformationen
\newcommand{\SUBJECT}{Report}
\newcommand{\TITLE}{Cloud Infrastructre Lab 1}

\input{../front.tex}

% E-Mail to beat.stettler@ins.hsr.ch bis Donnerstag 23:59

%TODO: Übersicht logische topologie erstellen
%TODO: IP Adressplan erstellen
%TODO: Layer 2 und Layer 3 Protokolle angeben

%TODO: Verify and proof problems with measured date
%TODO: Empfehlungen für Anpassungen am Netzwerk
%TODO: Kostenvoranschlag für das Beheben der Fehler. Lösung mit dem kleinsten Einfluss auf das Produktive System und geringste Kosten


\section{Informationsbeschaffung}
In einem ersten Schritt wurden sämtliche Konfigurationen mit dem Tool Tftpd64 von den Router und Switches kopiert. Diese wurden dann in einem nächsten Schritt auf Fehlkonfigurationen analysiert. Dabei gingen wir nach folgendem Schema vor:

\begin{enumerate}
	\item Übersicht verschaffen. 
	\item Kopieren aller benötigten Konfigurationen
	\item Ordnen und Analysieren der Konfiguration. Was ist überhaupt vorhanden?
	\item Prüfen auf ''Common Mistakes'' mit besonderem Augenmerk auf die Layer 2 (VLAN, VTP, STP, Frame Relay) und Layer 3 Protokolle (OSPF)
	\item Auswerten der gefunden Fehler
	\item Feedback und Lösungsvorschläge
\end{enumerate}

\subsection{Tools}
Für die Analyse wurden folgende Tools verwendet
\begin{enumerate}
	\item Tftpd64 um Konfigurationen zu dumpen
	\item jPerf um den Durchsatz zu messen
	\item Putty für die Telnet und Serielle Verbindung zu den Router und Switches
\end{enumerate}

\subsection{Terminologie}
Damit die Namen mehr an Bedeutung gewinnen, sollen folgend einige Abkürzungen nach besten Wissen ausgeschrieben werden.
\begin{multicols}{2}
\begin{description}
	\item[HQ] Head Quarter
	\item[BR] Branch
	\item[DS] Distribution Switch
	\item[CS] Core Switch
	\item[WER] WAN Exchange Router
	\item[IER] Internet Exchange Router
	\item[FRR] FrameRelayRouter
\end{description}
\end{multicols}


\subsection{Konfiguration kopieren}
Für jedes Geräte wurden die Outputs der folgenden Befehle auf die lokalen Notebooks kopiert. Alle Konfiguration sind im Anhang \ref{appendix:configurations} zu finden:
\begin{lstlisting}[language=bash]
copy run tftp und dann [your local ip addr]
show ip interface brief
show cdp neighbors
show interface status
show interface trunk
show vlan
show ip route
show spanning
\end{lstlisting}

\subsection{Analyse des Konfigurationen}
Folgende Tabellen dienen als Erweiterung zu den graphischen Schemas.
\subsection{DHCP}
\begin{table}[h]
	\centering
	\begin{tabu} to \linewidth {l l X}
		\toprule 
		DHCP Pool & Beschreibung & Bemerkung \\
		\midrule
		172.16.1.0/24 & HR &  \\
		172.16.2.0/24 & ENGINEERING &  \\
		172.16.3.0/24 & PRODUCTION &  \\
		172.16.4.0/24 & FINANCE &  \\
		172.16.16.0/24 & IT & DHCP exlude 172.16.16.1, 172.16.16.10 172.16.16.12 \\
		172.16.17.0/24 & SERVER & DHCP exclude 172.16.17.1, 172.16.17.10 172.16.17.12 \\
		172.16.18.0/24 & MARKETING & DHCP exclude 172.16.18.250, 172.16.18.254, 172.16.18.10 172.16.18.12  \\
		172.16.19.0/24 & SALES & DHCP exclude 172.16.19.250, 172.16.19.254, 172.16.19.10 172.16.19.12 \\
		172.16.103.0/24 & Branch 2 & DHCP exlude 172.16.103.1, 172.16.103.10, 172.16.103.12 \\
		\bottomrule 
	\end{tabu} 
	\caption{DHCP Pools}
\end{table}

\subsection{VLAN}
IEEE 802.1Q = Paketbasierte tagged VLAN's
\begin{table}[h]
	\centering
	\begin{tabu} to \linewidth {l l l}
		\toprule 
		VLAN & Name & Bedeutung \\
		\midrule
		VLAN 10 & HR & Personalabteilung \\
		VLAN 11 & IT & IT Abteilung \\
		VLAN 99 & MGMT & Management\\
		VLAN 100 & STAFF & Mitarbeiter\\
		VLAN 150 & IWAS & ???\\
		VLAN 200 & STUDENTS & Studenten\\
		\bottomrule 
	\end{tabu} 
	\caption{VLAN's}
\end{table}

\begin{table}[h]
	\centering
	\begin{tabu} to \linewidth {l l l}
		\toprule 
		VLAN & Subnetz & Bemerkung \\
		\midrule
		VLAN1 & 172.16.103.0/24 & \\
		VLAN10 & 172.16.1.0/24 & \\
		VLAN11 & 172.16.2.0/24 & \\
		VLAN20 & no ip addr assigned & (router ospf) \\
		VLAN21 & 172.16.16.0/24 & (mtu-ignore) \\
		VLAN30 & 172.16.17.0/24 & \\
		VLAN40 & 172.16.18.0/24 & (standby) \\
		VLAN41 & 172.16.19.0/24 & (mtu ignore) \\
		VLAN100 & 172.16.20.0/24 & (mtu ignore) \\
		VLAN102 & 172.16.22.2/24 & \\
		VLAN103 & 172.16.23.0/24 & \\
		\bottomrule 
	\end{tabu} 
	\caption{VLAN Subnetze}
\end{table}

\includepdf[pages={1},landscape=true]{appendix/schemes/vlan.pdf}
\includepdf[pages={1},landscape=true]{appendix/schemes/L1.pdf}

\section{Gefundene Fehler und Verbesserungsvorschläge}


\subsection{Allgemeine Verbesserungsvorschläge}

\begin{itemize}
	\item Auf allen Routern sollte der DNS-Lookup bei einem Tippfehler deaktiviert werden.
	\item Die Geräte z.B. Switche in den Branches und Headquarter sind inkonsistent benannt.
\end{itemize}

\subsection{Layer 1}
Auf Layer 1 (dem physischen Netzwerk) gibt es gemäss der Vorgabe dieses Repots keine Fehler.

\subsection{Layer 2}
\subsubsection{Design}
\begin{itemize}
	\item HQ\_CS2 bildet die einzige Verbindung zu den Branches. Es bildet somit einen Single Point of Failure
\end{itemize}

\subsubsection{Interfaces / Router Connection Groups}
\begin{itemize}
	\item Die Port Channel Group 4 beim HQ\_CS1 ist auf Half Duplex 100Mbit/s eingestellt.
	\item Die Port Channel Group 2 bei HQ\_CS2 ist auf 10Mbit/s eingestellt. 
\end{itemize}

\subsubsection{Spanning Tree}

Beim Spanning Tree ist HQ\_AS1 als Root in diversen VLAN's eingetragen, dies ist jedoch eher eine Suboptimale Wahl, da so unnötig Traffic über die Verbindung zu DS1 gespielt wird.
%TODO: Auf welchen VLAN's ist HQ_AS1 root?
%TODO: Genauer anschauen bei anderen Geräten.

\subsubsection{VLAN}
\begin{description}
	\item[HQ\_AS1] \hfill \\
	  \begin{itemize}
		  \item VLAN1 ist Administratively Down
		  \item Nur Fa0/2, Gi0/1, Gi0/2 sind auf HQ\_AS1 für VLAN1 konfiguriert
		  \item Die meisten Interfaces auf HQ\_AS1 sind im VLAN 21; dies ist in  der VLAN Konfiguration nicht eingerichtet.
	  \end{itemize}
	\item[HQ\_AS6] Die Link-Gruppe 6 des Uplink ist als shutdown eingestellt, deshalb hat der Switch keinen Uplink.
	\item[HQ\_AS7] Beim HQ\_AS7 sind VLAN 10 und 11 auf Ports eingerichtet, aber nicht in der VLAN-Konfiguration
	\item[HQ\_AS3] Beim HQ\_AS3 sind VLAN 100 und 200 auf Ports eingerichtet, aber nicht in der VLAN-Konfiguration.
	\item[HQ\_AS8] Beim HQ\_AS8 ist VLAN 20 auf Ports eingerichtet, aber nicht in der VLAN-Konfiguration.
	\item[HQ\_AS9] Beim HQ\_AS9 VLAN 10 und VLAN 20 auf Ports eingerichtet, aber nicht in der VLAN-Konfiguration.
	\item[HQ\_AS10] Beim HQ\_AS10 VLAN 11 auf Ports eingerichtet, aber nicht in der VLAN-Konfiguration.

	\item[BR1\_S2] \hfill \\
	  \begin{itemize} 
		  \item Die VLANs nicht auf den Ports zugeordnet.
		  \item Die Trunk-Ports zum Router sind nicht richtig konfiguriert (nämlich auf access und spanning-tree portfast)
	  \end{itemize}
	\item[BR1\_S3] \hfill \\
	  \begin{itemize} 
		  \item Die VLANs nicht auf den Ports zugeordnet. 
		  \item Die Trunk-Ports zum Router sind nicht richtig konfiguriert (nämlich auf access und spanning-tree portfast)
	  \end{itemize}
	\item[BR1\_S4] \hfill \\
	  \begin{itemize} 
		  \item Die VLANs nicht auf den Ports zugeordnet. 
		  \item Die Trunk-Ports zum Router sind nicht richtig konfiguriert (nämlich auf access und spanning-tree portfast)
	  \end{itemize}
	
	\item[BR2\_S1] \\ \hfill
		\begin{itemize}
			\item VLAN1 ist shutdown, darum gehen die Access-Switches im ganzen BR2 nicht.
		\end{itemize}
	\item[BR2\_S2] \\ \hfill
	  \begin{itemize}
		  \item Die VLANs nicht auf den Ports zugeordnet.
		  \item VLAN103 ist als Virtuelles Interface eingerichtet, allerdings nicht in der vlan.dat eingetragen.
		\end{itemize}
	\item[BR2\_S3] \\ \hfill
	  \begin{itemize}
	  	\item Die VLANs nicht auf den Ports zugeordnet.
		  \item VLAN103 ist als Virtuelles Interface eingerichtet, allerdings nicht in der vlan.dat eingetragen.
		\end{itemize}
	\item[BR2\_S4] \\ \hfill
	  \begin{itemize}
	  	\item Die VLANs nicht auf den Ports zugeordnet.
		  \item VLAN103 ist als Virtuelles Interface eingerichtet, allerdings nicht in der vlan.dat eingetragen.
		\end{itemize}
\end{description}

\subsubsection{Frame Relay}

\subsection{Layer 3}

\subsubsection{Routen}

\begin{description}
	\item[FrameRelayRouter] \hfill \\
		\begin{itemize}
			\item Die Routen über das FrameRelay sind überall sehr hoch. Ist dies bewusst aufgrund der Kosten gewählt?
\end{description}

\subsubsection{OSPF}

\section{Messungen}
Alle Durchgeführten Messungen sind im Anhang \ref{appendix:measures} zu finden.

\subsection{Folgerungen}
% TODO add folgerungen


%TODO Ist ein Port mit langsamem Durchsatz konfiguriert?


\section{Empfehlungen}
Aufgrund der vorangehenden Erkenntnissen empfehlen wir, an folgenden Punkten anzusetzen:
%TODO add recommedations
\begin{enumerate}
	\item Alle 10 und 100Mbit/s Leitung auf den maximal physisch möglichen Durchsatz aufschrauben.
\end{enumerate}

\subsection{Kostenvoranschlag}
Für die Umsetzung unserer Empfehlungen würden folgende Kosten anfallen.
\begin{table}[h]
	\centering
	\begin{tabu} to \linewidth {l l l l}
		\toprule 
		Beschreibung & Zeitaufwand in h  & Stundenansatz in CHF & Total \\
		\midrule
		&&& \\
		\textbf{Total} & & & \underline{\underline{1 Million}} \\
		\bottomrule 
	\end{tabu} 
	\caption{Kostenvoranschlag}
\end{table}

\input{appendix.tex}
