\input{../template.tex}

% Dokumentinformationen
\newcommand{\SUBJECT}{Report}
\newcommand{\TITLE}{Cloud Infrastructre Lab 6}

\input{../front.tex}

\section{Modern Data Center Requirements} %TODO: 1A4 Seite

% - was ändert sich
% - was ist heutigen DC anders als 20 jahre
eine Seite

\subsection{Challanges}
%TODO
\subsection{Requirements}
%TODO
\subsection{Network architecture}
%TODO
\section{TRILL}

\subsection{Theorie}
\subsection{Terminologie}
\begin{description}
	\item[RBrige] Bridge die TRILL unterstützt und verwendent
	\item[Ingress RBRige] \hfill \\
	Bridges die beim Eingang in die TRILL ''Wolke'' stehen. Sie fügen den TRILL Header hinzu
	\item[Egress RBRige] \hfill \\
	Bridges die beim Ausgang der TRILL ''Wolke'' stehen. Sie entfernen den TRILL Header.
	\item[Transit RBridge]  \hfill \\
	Bridges die den TRILL Verkehr nur weiterleiten und dabei nur den Outer Ethernet Header beachten. Sie stehen innerhalb der TRILL ''Wolke''.
\end{description}

\subsubsection{Funktion} %function / protocol header
Das TRILL Protokoll  (Transparent Interconnection of Lots of Links) implementiert ein Routing auf Layer 2. Das Routing wird mit sogenannten RBridges vollzogen. RBridges routen die verpackten Ethernet Frames mit dem Link-State-Protokoll IS-IS (Intermediate System to Intermediate System). TRILL kann relativ einfach in eine bestehendes Netz eingefügt werden, da Bridges ohne TRILL Funktion, die restlichen RBridges als Wolke und somit als ein grossen Switch wahrnehmen. (Vergleichbar mit MPLS). \\ 

Versendet ein Client A ein Paket an Client B, wird das MAC Frame bei der Ingress RBrige in ein TRILL Paket verpackt. Anschliessend routet IS-IS das Paket zur Egress Bridge welche den TRILL Header wieder entfernt und das ursprüngliche MAC Frame auspackt.  \\

%TODO Check ECMP
Edge RBridges (Ingress, Egress) lernen die angeschlossen Clients auf die klassische Art und Weise über ARP. Die gelernenten MAC-Adressen werden dann über IS-IS an die weiteren RBridges verteilt. Da Link State Protokolle über die gesammte Netzwerktopologie bescheid wissen, kann IS-IS optimale Pfade für Unicast, sowie Distribution Trees für unbekannte Hosts und Broadcast und Multicast Gruppen berechnen. Die berechneten Bäume bilden einen Pfad zu allen Egress Bridges ab. Durch das Equal Cost Multipath Routing (ECMP) werden alle Pfade mit gleichen Kosten zu einem Ziel parallel genutzt. Dadurch erreicht man eine höhere Bandbreit, als dies unter STP möglich war. Um Schleifen zu vermeiden, gibt es im TRILL Header den Hop Count, sowie wird ein Reverse-Patch-Check von den RBridges durchgeführt.

\subsection{Protokoll Header}
Ein TRILL Frame ist in drei Schichten aufgeteilt:
\begin{description}
	\item[Outer Ethernet Header] \hfill \\
	Der äussere Ethernet Header wird bei jedem Hop geändert. Dabei bleibt der innere Header konsistenz (inkl. VLAN Tag). Im Outer Header stehen die MAC Adressen der RBridges.
	\item[TRILL Header] \hfill \\
	Das interessanteste im TRILL Header ist die Ingress-RBridge (Source) und Egress-RBrige (Destination). Jede RBridge wird mit einem Nickname (2Byte Hexadezimal) eindeutig identifiziert. (z.B \lstinline[]|0x56ce|) 
	\begin{itemize}
		\item Hop Count: Wird beim passieren jeder RBridge verkleinert und verhindert dass ein Paket zu loopen beginnt. Jede RBridge setze die erwartete Anzahl Hops bis ihrem Ziel.
		\item Nickname: Der RBridge Nickname ist eine Abkürzung (2Byte) der 6Byte langen IS-IS System ID der Bridge. Sie ist eindeutig innerhalb eines Netzes. 
		\item M Bit (Multidestination): 0 = Unicast, 1 = Distribution Tree
	\end{itemize}
	\item[Inner Ethernet Header] \hfill \\
	Im Inner Ethernet Header stehen MAC-Adressen der beiden Endstation sowie der VLAN Tag.
\end{description}

\begin{figure}[h]
\centering
\includegraphics[width=0.5\linewidth]{images/trill_header}
\caption{TRILL Frame}
\label{fig:trillheader}
\end{figure}

\subsubsection{Ziel von TRILL} %goal of trill
Das Ziel von TRILL ist es auf Layer 2 ein Routing zu betreiben und dabei die Nachteile von STP zu lösen.

\subsubsection{Warum wurde TRILL entwickelt?} %why was trill developed?
TRILL wurde entwickelt um das Spanning Tree Protocol (STP) zu ersetzen. STP wurde entwickelt um Bridging Loops zu unterbinden. Das Problem bei SDP ist, dass es eine relativ grosse Konvergenzzeit hat, was in Rechenzentren inakzeptabel ist. TRILL wurde entwickelt um genau dieses Problem zu lösen. TRILL verwendet IS-IS (Intermediate System to Intermediate System Protocol) auf Layer 2. IS-IS ist wie OSPF eine Link State Protokoll welches aber im Gegensatz zu OSPF auf L2 operieren kann. Wie alle Link State Protokollen weiss jede RBridge über die gesamte Topologie bescheid. 

\subsubsection{Wo und wie kann TRILL eingesetzt werden (Use Cases)?} %where and how can trill be used? (use cases)


\paragraph{High Performance Datacenter}
Bei Datencenter versucht man die Spine-Leaf Architektur umzusetzen. Dazu integriert man Edge- und Aggregation-Layer und setzt im Core mehrere kleine Systeme statt wenig grosse ein, die man zu einem virtuell Device zusammenfasst. Diese Flachen Netze werden dann mit TRILL verwaltet. Da TRILL alle verfügbaren Ports und Pfade nutzt, kann die Payload mit einer maximalen Bandbreite übertragen werden. 


\subsubsection{Ist TRILL kompatibel mit traditionellen Protokollen?} %is trill comparable to a traditional protcol?
%  if yes, what are the differences and which limitiations does TRILL solve?
TRILL ist kompatibel mit VLAN und STP. Der VLAN Tag des Inner Ethernet Header wird bei der Übertragung durch Transit RBridges nicht beachtet. Der VLAN Tag im Outer Ethernet Header wird nur verwendet wenn zwei RBridges über unterschiedliche VLAN's kommunizieren. STP Bridges ohne TRILL Funktionalität erkennen die TRILL ''Wolke'' als einen grossen Switch. TRILL agiert für das restliche 802.1 Netzwerk als eigenständiges System operiert somit oberhalb des klassischen Layer 2.  
%TODO

\subsubsection{Was sind die Vor- und Nachteile von TRILL?}%what are the advantages and disadvantages of TRILL
\paragraph{Vorteile} \hfill \\
Die Vorteile von TRILL decken sich mit den Kritikpunkten an STP. So gibt es bei TRILL keine blockierten Ports (die ganze Bandbreite kann genutzt werden) und es gibt keine Probleme mit der Konvergationszeit des L2 Netzes. Dadurch kann auf STP verzichtet werden. 
TRILL erlaubt es Virtuelle Maschienen zu verschieben (z.B VMotion) ohne dass man sich Gedanken über die IP Subnetze machen muss.
%TODO ECMP

\paragraph{Nachteile} \hfill \\
Ein Kritikpunkt an TRILL ist, dass es zu schlechtem Design in den Rechenzentren führe und Alternative Protokolle wie z.B SPB das Problem eleganter lösen.

\subsubsection{Gibt es andere moderne Technologien, welche TRILL ähnlich sind?}%are there other modern technologies which are similar to TRILL?
%  if yes, what are the differences between them
Der grösste Konkurenz von TRILL ist SPB (Shortest Path Bridging oder IEEE 802.1aq). SPB wurde als Erweiterung von VLAN entwickelt, mit dem gleichen Ziel, um die Konvergenzzeit von STP zu verbessern. SPB verwendet das herkömmliche Header Format, wodurch ohne Hardware Update in ein bestehendes Netzwerk eingefügt werden kann. 


\subsection{Lab Konfiguration}
\begin{figure}[h]
	\centering
	\includegraphics[width=1\linewidth]{trill_network_layer2}
	\caption{Lab TRILL Layer 1/2 Struktur (Quelle: Auftrag Lab 7)}
	\label{fig:trillnetworklayer2}
\end{figure}

\subsubsection{Trees}
%TODO

\subsubsection{PacketFlow}
%TODO

\subsubsection{Mac Learning}

%TODO


\section{VXLAN}
\subsection{Terminologie}
\begin{description}
	\item[VXLAN: Virtual eXtensible Local Area Network] description
	\item[VNI: VXLAN Network Identifier] 
	\item[VTEP: VXLAN Tunnel End Point] description 

\end{description}
%TODO
\input{appendix.tex}
